<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %></title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .qr-container { text-align: center; margin-top: 50px; }
        .qr-container img { width: 250px; height: 250px; }
        .timer { font-size: 1.2rem; color: red; margin-top: 10px; }
    </style>
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="text-center">Scan NETS QR to Pay</h2>
    <hr>

    <div class="qr-container">
        <img src="<%= qrCodeUrl %>" alt="NETS QR Code">
        <p class="mt-3">Transaction Reference: <strong><%= txnRetrievalRef %></strong></p>
        <p>Total Amount: <strong>$<%= total %></strong></p>
        <p class="timer" id="timer">05:00</p>
        <p class="text-muted">Scan the QR code using your NETS app within 5 minutes.</p>
    </div>

    <div class="mt-4 text-center">
        <a href="/payment/netqr/success" class="btn btn-success">Simulate Payment Success</a>
        <a href="/payment/netqr/fail" class="btn btn-danger">Simulate Payment Fail</a>
    </div>
</div>

<script>
    // 5-minute countdown timer
    let timeLeft = 300; // seconds
    const timerEl = document.getElementById('timer');

    const timerInterval = setInterval(() => {
        const minutes = Math.floor(timeLeft / 60).toString().padStart(2, '0');
        const seconds = (timeLeft % 60).toString().padStart(2, '0');
        timerEl.textContent = `${minutes}:${seconds}`;
        timeLeft--;

        if(timeLeft < 0) {
            clearInterval(timerInterval);
            alert('Time expired! Please try again.');
            window.location.href = '/checkout'; // redirect back to checkout
        }
    }, 1000);
</script>
</body>
</html>
