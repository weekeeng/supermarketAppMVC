<!DOCTYPE html>
<html>
<head>
    <title>PayPal Payment</title>
    <script src="https://www.paypal.com/sdk/js?client-id=<%= process.env.PAYPAL_CLIENT_ID %>&currency=SGD"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5">
    <h2 class="text-center">PayPal Payment</h2>
    <hr>
    <p>Total Amount: <strong>$<%= totalAmount %></strong></p>

    <div id="paypal-button-container"></div>
</div>

<script>
    paypal.Buttons({
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value: '<%= totalAmount.toFixed(2) %>'
                    }
                }]
            });
        },
        onApprove: function(data, actions) {
            return fetch('/paypal-capture', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ orderId: data.orderID })
            })
            .then(response => response.json())
            .then(res => {
                if(res.success){
                    window.location.href = res.redirectUrl;
                } else {
                    window.location.href = res.redirectUrl;
                }
            });
        },
        onCancel: function(data){
            window.location.href = '/payment/paypal/fail';
        },
        onError: function(err){
            console.error(err);
            window.location.href = '/payment/paypal/fail';
        }
    }).render('#paypal-button-container');
</script>
</body>
</html>
